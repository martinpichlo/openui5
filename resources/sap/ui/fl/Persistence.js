/*!
 * OpenUI5
 * (c) Copyright 2009-2019 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/fl/DefaultVariant","sap/ui/fl/StandardVariant","sap/ui/fl/Utils","sap/ui/fl/ChangePersistenceFactory"],function(D,S,U,C){"use strict";var P=function(c,s){this._oControl=c;this._sStableIdPropertyName=s||'id';this._sStableId=this._getStableId();this._sComponentName=U.getComponentClassName(c);if(!this._sComponentName){U.log.error("The Control does not belong to an SAPUI5 component. Variants and Changes for this control might not work as expected.");}this._oAppDescriptor=U.getAppDescriptor(c);this._sSiteId=U.getSiteId(c);this._oChangePersistence=C.getChangePersistenceForControl(this._oControl);this._oChanges={};};P.prototype._getStableId=function(){if(!this._oControl){return undefined;}if((this._sStableIdPropertyName)&&(this._sStableIdPropertyName!=='id')){var s;try{s=this._oControl.getProperty(this._sStableIdPropertyName);}catch(e){s="";}return s;}if(typeof this._oControl.getId!=='function'){return undefined;}return this._oControl.getId();};P.prototype.getChanges=function(){var p={appDescriptor:this._oAppDescriptor,siteId:this._sSiteId,includeVariants:true};if(!jQuery.isEmptyObject(this._oChanges)){return Promise.resolve(this._oChanges);}return this._oChangePersistence.getChangesForVariant(this._sStableIdPropertyName,this._sStableId,p).then(function(c){this._oChanges=c;return this._oChanges;}.bind(this));};P.prototype.getChange=function(c){if(!c){U.log.error("sap.ui.fl.Persistence.getChange : sChangeId is not defined");return undefined;}return this._oChanges[c];};P.prototype.addChange=function(p){return this._oChangePersistence.addChangeForVariant(this._sStableIdPropertyName,this._sStableId,p);};P.prototype.getExecuteOnSelect=function(){return this.getChanges().then(function(c){return S.getExecuteOnSelect(c);});};P.prototype.getExecuteOnSelectSync=function(){return S.getExecuteOnSelect(this._oChanges);};P.prototype.setExecuteOnSelectSync=function(e){var p,c;var s={};s[this._sStableIdPropertyName]=this._sStableId;p={executeOnSelect:e,reference:this._sComponentName,selector:s};c=S.updateExecuteOnSelect(this._oChanges,e);if(c){return c;}c=S.createChangeObject(p);var a=c.getId();this._oChanges[a]=c;return c;};P.prototype.getDefaultVariantId=function(){return this.getChanges().then(function(c){return D.getDefaultVariantId(c);});};P.prototype.getDefaultVariantIdSync=function(){return D.getDefaultVariantId(this._oChanges);};P.prototype.setDefaultVariantIdSync=function(d){var p,c;var s={};s[this._sStableIdPropertyName]=this._sStableId;p={defaultVariantId:d,reference:this._sComponentName,selector:s,validAppVersions:{creation:this._oChangePersistence._mComponent.appVersion,from:this._oChangePersistence._mComponent.appVersion}};c=D.updateDefaultVariantId(this._oChanges,d);if(c){return c;}c=D.createChangeObject(p);var a=c.getId();this._oChanges[a]=c;return c;};P.prototype.saveAll=function(){return this._oChangePersistence.saveAllChangesForVariant(this._sStableId);};P.prototype.isVariantDownport=function(){var l,i;l=U.getCurrentLayer();i=U.isHotfixMode();return((l==='VENDOR')&&(i));};return P;},true);
